#!/bin/sh
prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
pkgdatadir=@datadir@/@PACKAGE@

WAS_UNICODE=false
kbd_mode | grep -q Unicode && WAS_UNICODE=true

LOWER='abcdefghijklmnopqrstuvwxyz'
UPPER='ABCDEFGHIJKLMNOPQRSTUVWXYZ'

if [ -z "$1" ]; then
	LANGUAGE=`echo $LANG | sed "s/...\(..\).*/\1/;y/$UPPER/$LOWER/"`
	echo $LANGUAGE
else
	LANGUAGE=$1
fi

if ! ${WAS_UNICODE}; then
	kbd_mode -u
	echo -ne '\033%G'
fi

loadkeys ${pkgdatadir}/keymap/$LANGUAGE.map.gz 2>/dev/null ||
loadkeys $LANGUAGE
setfont ${pkgdatadir}/font/bicon-8x16-512.psfu.gz

${bindir}/bicon.bin

setfont
loadkeys -d 2>/dev/null

if ${WAS_UNICODE}; then
	dumpkeys | loadkeys -u
else
	kbd_mode -a
	echo -ne '\033%@'
fi

